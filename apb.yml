version: 1.0
name: rhpam-apb
description: RHPAM
bindable: false
async: unsupported
metadata:
  displayName: RHPAM (APB)
  documentationUrl: https://developers.redhat.com/products/bpmsuite/docs-and-apis/
  longDescription:
    An APB that deploys Red Hat Process Automation Manager 7.0 (RHPAM) on OpenShift.
    Offers different plans depending on the requirements to deploy an Authoring environment
    or a Production server with immutable monitor.
  console.openshift.io/iconClass: icon-processserver
  providerDisplayName: "Red Hat, Inc."
  serviceName: rhpam
  dependencies:
    - 'registry.access.redhat.com/rhpam-7/rhpam70-kieserver-openshift'
    - 'registry.access.redhat.com/rhpam-7/rhpam70-businesscentral-openshift'
    - 'registry.access.redhat.com/rhpam-7/rhpam70-controller-openshift'
    - 'registry.access.redhat.com/rhpam-7/rhpam70-smartrouter-openshift'
    - 'registry.access.redhat.com/rhpam-7/rhpam70-businesscentral-monitoring-openshift'
    - 'registry.access.redhat.com/rhscl/postgresql-96-rhel7'
    - 'registry.access.redhat.com/rhscl/mysql-57-rhel7'
tags:
  - jbpm
  - rhpam
plans:
  - name: authoring
    description: Deploys Business Central and KIE Execution Server
    free: true
    metadata:
      displayName: RHPAM Authoring
    parameters:
      # Common Credentials
      - name: apb_eap_admin_user
        title: EAP Admin Username
        description: Admin username for all EAP Servers
        required: true
        type: string
        default: eapadmin
      - name: apb_eap_admin_pwd
        title: EAP Admin Password
        description: Admin username for all EAP Servers. Generated if empty
        required: false
        type: string
        display_type: password
      - name: apb_kie_admin_user
        title: Admin Username
        description: Admin username for Business Central and Execution Server
        required: true
        type: string
        default: adminUser
      - name: apb_kie_admin_pwd
        title: Admin Password
        description: Admin user password for Business Central and Execution Server. Generated if empty
        required: false
        type: string
        display_type: password

      # Business Central
      - name: apb_businesscentral_controller_user
        title: Business Central Username
        description: Username to access to the Business Central UI
        required: true
        type: string
        default: controllerUser
        display_group: Business Central
      - name: apb_businesscentral_controller_pwd
        title: Business Central Password
        description: User password to access to the Business Central UI. Generated if empty
        required: false
        type: string
        display_type: password
        display_group: Business Central
      - name: abp_businesscentral_hostname
        title: Public Hostname
        description: Public hostname where Business Central will be accessed from. Generated if empty
        required: false
        type: string
        display_group: Business Central
      - name: apb_businesscentral_secret_name
        title: Secret Name
        description: Name of the secret containing the keystore to be used by the server. Generated if empty
        required: false
        type: string
        display_group: Business Central
      - name: apb_businesscentral_keystore_name
        title: Keystore Name
        description: Name of the keystore file containing the certificate to be used by the server.
        required: true
        type: string
        default: keystore.jks
        display_group: Business Central
      - name: apb_businesscentral_keystore_alias
        title: Keystore certificate alias
        description: Name of the certificate alias included in the keystore to be used by the server.
        required: true
        type: string
        default: jboss
        display_group: Business Central
      - name: apb_businesscentral_keystore_pwd
        title: Keystore and Certificate Password
        description: Password protecting both the Keystore and the Certificate. Generated if empty
        required: false
        type: string
        display_type: password
        display_group: Business Central
      - name: apb_businesscentral_limits_memory
        title: Memory Limits
        description: Memory limits to set for Business Central.
        required: true
        type: string
        pattern: "^[0-9]+[mMgGtT]i?$"
        default: 2Gi
        display_group: Business Central
      - name: apb_businesscentral_volume_size
        title: Workspace Storage Size
        description: Specify the Persistent Volume Claim size to create for storing the Workspace. Leave empty for ephemeral storage. e.g. 10Gi
        required: false
        type: string
        pattern: "^[0-9]+[mMgGtT]i?$"
        display_group: Business Central
      - name: apb_businesscentral_maven_user
        title: Maven repository username
        description: Username used to interact with the Maven Repository hosted by Business Central
        required: true
        type: string
        default: mavenUser
        display_group: Business Central
      - name: apb_businesscentral_maven_pwd
        title: Maven repository password
        description: User password used to interact with the Maven Repository hosted by Business Central. Generated if emtpy
        required: false
        type: string
        display_type: password
        display_group: Business Central

      # Business Central SSO
      - name: apb_sso_url
        title: RH-SSO URL
        description: Red Hat Single Sign-On URL. Leave empty to avoid using SSO. E.g. https://rhsso.example.com/auth
        required: false
        type: string
        display_group: Business Central - RH-SSO
      - name: apb_sso_realm
        title: RH-SSO Realm
        description: Red Hat Single Sign-On Realm name. E.g. rhpam
        required: false
        type: string
        display_group: Business Central - RH-SSO
      - name: apb_sso_client
        title: RH-SSO Client
        description: Red Hat Single Sign-On Client name. If the secret, user and password are provided it will be created. E.g. businesscentral
        required: false
        type: string
        display_group: Business Central - RH-SSO
      - name: apb_sso_client_secret
        title: RH-SSO Client Secret
        description: Red Hat Single Sign-On Client secret.
        required: false
        type: string
        display_group: Business Central - RH-SSO
      - name: apb_sso_user
        title: RH-SSO Admin User
        description: Red Hat Single Sign-On User to be used to create the Client if it doesn't exist. The user must be able to create secrets on the given realm.
        required: false
        type: string
        display_group: Business Central - RH-SSO
      - name: apb_sso_pwd
        title: RH-SSO Admin Password
        description: Red Hat Single Sign-On Password to use to create the Client if it doesn't exist.
        required: false
        type: string
        display_type: password
        display_group: Business Central - RH-SSO
      - name: apb_sso_disable_ssl_cert_validation
        title: RH-SSO Disable SSL Validation
        description: Disable SSL Certificate Validation when connecting to RH-SSO
        required: false
        type: boolean
        display_group: Business Central - RH-SSO

      # KIE Execution Server
      - name: apb_kie_execution_user
        title: Execution Server Username
        description: User to interact with the REST API
        required: true
        type: string
        default: executionUser
        display_group: KIE Execution Server
      - name: apb_kie_execution_pwd
        title: Execution Server Password
        description: User password to interact with the REST API. Generated if empty
        required: false
        type: string
        display_type: password
        display_group: KIE Execution Server
      - name: abp_kie_execution_hostname
        title: Public Hostname
        description: Public hostname where the Execution Server will be accessed from. Generated if empty
        required: false
        type: string
        display_group: KIE Execution Server
      - name: apb_kie_execution_secret_name
        title: Secret Name
        description: Name of the secret containing the keystore to be used by the server. Generated if empty
        required: false
        type: string
        display_group: KIE Execution Server
      - name: apb_kie_execution_keystore_name
        title: Keystore Name
        description: Name of the keystore file containing the certificate to be used by the server.
        required: true
        type: string
        default: keystore.jks
        display_group: KIE Execution Server
      - name: apb_kie_execution_keystore_alias
        title: Keystore certificate alias
        description: Name of the certificate alias included in the keystore to be used by the server.
        required: true
        type: string
        default: jboss
        display_group: KIE Execution Server
      - name: apb_kie_execution_keystore_pwd
        title: Keystore and Certificate Password
        description: Password protecting both the Keystore and the Certificate. Generated if empty
        required: false
        type: string
        display_type: password
        display_group: KIE Execution Server
      - name: apb_kie_execution_limits_memory
        title: Memory Limits
        description: Memory limits to set for KIE Execution Server.
        required: true
        type: string
        pattern: "^[0-9]+[mMgGtT]i?$"
        default: 1Gi
        display_group: KIE Execution Server
      - name: apb_kie_execution_db_type
        title: Database Type
        description: Database Type to persist the KIE Execution Server runtime information
        required: true
        type: enum
        enum: ['H2', 'PostgreSQL', 'MySQL']
        default: H2
        display_group: KIE Execution Server
      - name: apb_kie_execution_db_size
        title: Database Storage Size
        description: Specify the Persistent Volume Claim size to create for the Database. Leave empty for ephemeral storage. e.g. 10Gi
        required: false
        type: string
        pattern: "^[0-9]+[mMgGtT]i?$"
        display_group: KIE Execution Server

      # External Maven Repository
      - name: apb_maven_repo_url
        title: Maven Repository URL
        description: External Maven Repository URL. Leave empty to use the repository provided by Business Central
        required: false
        type: string
        display_group: External Maven Repository
      - name: apb_maven_repo_user
        title: Maven Repository Username
        description: Username to use to interact with the external Maven repository.
        required: false
        type: string
        display_group: External Maven Repository
      - name: apb_maven_repo_pwd
        title: Maven Repository Password
        description: Password to use to interact with the external Maven repository.
        required: false
        type: string
        display_type: password
        display_group: External Maven Repository

  - name: production
    description: Deploy RHPAM Production
    free: true
    metadata:
      displayName: RHPAM Production
    parameters:
      # Business Central Monitoring
      - name: apb_businesscentral_monitoring_volume_size
        type: string
        title: Workspace Storage Size
        pattern: "^[0-9]+[mMgGtT]i?$"
        required: false
        description: Specify the Persistent Volume Claim size to create for storing the Workspace. Leave empty for ephemeral storage. e.g. 10Gi
        display_group: Business Central Monitoring
      - name: apb_businesscentral_monitoring_limits_memory
        type: string
        title: Memory Limits
        pattern: "^[0-9]+[mMgGtT]i?$"
        required: true
        default: 2Gi
        description: Memory limits to set for Business Central.
        display_group: Business Central Monitoring
      - name: apb_businesscentral_monitoring_secret_name
        type: string
        title: Secret name
        required: false
        description: Name of the Secret containing the keystore to use. Leave empty to generate one.
        display_group: Business Central Monitoring
      # - name: apb_businesscentral_monitoring_ha
      #   type: boolean
      #   title: High Availability (HA)
      #   required: true
      #   description: Deploy Business Central Monitoring in High Availability.
      #   display_group: Business Central Monitoring

      # KIE Server
      - name: apb_kieserver_db_type
        type: enum
        title: Database Type
        default: H2
        enum: ['H2', 'PostgreSQL', 'MySQL']
        required: true
        display_group: KIE Server
      - name: apb_kieserver_db_size
        type: string
        title: Database Storage Size
        pattern: "^[0-9]+[mMgGtT]i?$"
        required: false
        description: Specify the Persistent Volume Claim size to create for the Database. Leave empty for ephemeral storage. e.g. 10Gi
        display_group: KIE Server
      - name: apb_kieserver_limits_memory
        type: string
        title: Memory Limits
        pattern: "^[0-9]+[mMgGtT]i?$"
        required: true
        default: 1Gi
        description: Memory limits to set for KIE Server.
        display_group: KIE Server
      - name: apb_kieserver_secret_name
        type: string
        title: Secret name
        required: false
        description: Name of the Secret containing the keystore to use. Leave empty to generate one.
        display_group: KIE Server
      - name: apb_kieserver_external_maven_repo
        type: string
        title: External Maven Repository
        required: false
        description: Name of the Secret containing the keystore to use. Leave empty to generate one.
        display_group: KIE Server
      # - name: apb_kieserver_ha
      #   type: boolean
      #   title: High Availability (HA)
      #   required: true
      #   description: Deploy KIE Server in High Availability. Will deploy multiple instances
      #   display_group: KIE Server

  - name: kieserver
    description: Deploy RHPAM KIE Server
    free: true
    metadata:
      displayName: RHPAM KIE Server
    parameters:
      # KIE Server
      - name: apb_kieserver_db_type
        type: enum
        title: Database Type
        default: H2
        enum: ['H2', 'PostgreSQL', 'MySQL']
        required: true
      - name: apb_kieserver_db_size
        type: string
        title: Database Storage Size
        pattern: "^[0-9]+[mMgGtT]i?$"
        required: false
        description: Specify the Persistent Volume Claim size to create for the Database. Leave empty for ephemeral storage. e.g. 10Gi
      - name: apb_kieserver_limits_memory
        type: string
        title: Memory Limits
        pattern: "^[0-9]+[mMgGtT]i?$"
        required: true
        default: 1Gi
        description: Memory limits to set for KIE Server.
      - name: apb_kieserver_secret_name
        type: string
        title: Secret name
        required: false
        description: Name of the Secret containing the keystore to use. Leave empty to generate one.
      - name: apb_kieserver_external_maven_repo
        type: string
        title: External Maven Repository
        required: false
        description: Name of the Secret containing the keystore to use. Leave empty to generate one.
      # - name: apb_kieserver_ha
      #   type: boolean
      #   title: High Availability (HA)
      #   required: true
      #   description: Deploy KIE Server in High Availability. Will deploy multiple instances
